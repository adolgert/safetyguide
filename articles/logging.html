<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logging • safetyguide</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Logging">
<meta property="og:description" content="How to use logging in a research package.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">safetyguide</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/configuration.html">Configuration</a>
    </li>
    <li>
      <a href="../articles/documentation.html">Documentation</a>
    </li>
    <li>
      <a href="../articles/formatting.html">Formatting</a>
    </li>
    <li>
      <a href="../articles/logging.html">Logging</a>
    </li>
    <li>
      <a href="../articles/organizing.html">Organization</a>
    </li>
    <li>
      <a href="../articles/packages.html">Packages</a>
    </li>
    <li>
      <a href="../articles/provenance.html">Provenance</a>
    </li>
    <li>
      <a href="../articles/testing.html">Testing</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="logging_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Logging</h1>
            
      
      
      <div class="hidden name"><code>logging.Rmd</code></div>

    </div>

    
    
<div id="logging" class="section level1">
<h1 class="hasAnchor">
<a href="#logging" class="anchor"></a>Logging</h1>
<p>If you want to print something from a script, the <code>paste</code> and <code>cat</code> work well for personal, interactive use. When you write code for the cluster, it means the same script has to work under several different conditions:</p>
<ol style="list-style-type: decimal">
<li>Run on your local machine.</li>
<li>Run on the cluster in production mode.</li>
<li>Run on the cluster so you can search for a bug.</li>
</ol>
<p>A logging library gives you a way to control how much the script prints and where that output goes, so that you can tailor the script’s output to the current conditions. If you’re set up to use a logging library, you’re also set up to write logs to a log server.</p>
<div id="log-servers" class="section level2">
<h2 class="hasAnchor">
<a href="#log-servers" class="anchor"></a>Log Servers</h2>
<p>There is a line in the book <em>Legacy Code</em> that says a log server is the first thing you set up if you don’t want your boss to come banging on your door at all hours. A log server is low on Maslow’s pyramid of programmer needs. It is a central place that all logs are saved from all code executions. It has a specified policy for when logs are deleted. It’s a lifesaver if you need to know something about a run six months ago.</p>
</div>
<div id="how-to-call-a-logger" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-call-a-logger" class="anchor"></a>How to call a logger</h2>
<p>We want an interface to logging that lets us configure it once, either by examining environment variables or by looking at command-line arguments. Find this code in the package source under <code>logging.R</code>. It uses the <a href="https://cran.r-project.org/web/packages/futile.logger/index.html">futile.logger</a> package underneath.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="st">"log"</span><span class="op">]</span> <span class="op">==</span> <span class="st">"local"</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">safetyguide</span><span class="fu">::</span><span class="fu"><a href="../reference/local_logging.html">local_logging</a></span><span class="op">(</span><span class="st">"debug"</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="fu">safetyguide</span><span class="fu">::</span><span class="fu"><a href="../reference/cluster_logging.html">cluster_logging</a></span><span class="op">(</span><span class="st">"info"</span>, error_file <span class="op">=</span> <span class="st">"out.log"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Then, in the code itself, log at levels for tracing, debugging, info, warning, or error.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">value</span> <span class="op">&lt;-</span> <span class="fl">7</span>
<span class="fu"><a href="../reference/localLoggingFunctions.html">loginfo</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Had a problem with"</span>, <span class="va">value</span>, <span class="st">"items"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/localLoggingFunctions.html">logtrace</a></span><span class="op">(</span><span class="st">"entering core function"</span><span class="op">)</span>
<span class="fu"><a href="../reference/localLoggingFunctions.html">logdebug</a></span><span class="op">(</span><span class="st">"On the 3rd iteration."</span><span class="op">)</span></code></pre></div>
</div>
<div id="log-levels" class="section level2">
<h2 class="hasAnchor">
<a href="#log-levels" class="anchor"></a>Log levels</h2>
<p>As a rule of thumb,</p>
<ul>
<li><p>trace - This output is meant to be read by another program, not a person. It can announce entry and exit of individual functions, for instance.</p></li>
<li><p>debug - What you print in order to know if an algorithm is working as expected. The <em>Debugging Applications</em> book recommends never deleting these statements if they are written with a logger at the debug level.</p></li>
<li><p>info - What you would put into a print statement, and print on every run. These could include the names of files read and written, or the list of command-line arguments. They could announce the choice of which algorithm to run. These are stored in cluster logs and can serve as provenance.</p></li>
<li><p>warning - Something that is likely a problem but is recoverable. If you use these as todo reminders, then you will miss actual warnings.</p></li>
<li><p>error - An error may be recoverable, but the code that finds the error cannot recover. An outer layer of code, running an error handler, may deal with it.</p></li>
<li><p>fatal - A non-recoverable error, as determined by the local code.</p></li>
</ul>
<p>As a last note, the way this code is written means that we can use <code>futile.logger</code>, or another logging package, underneath, and the main code won’t need to change.</p>
</div>
<div id="improving-error-messages-for-logging" class="section level2">
<h2 class="hasAnchor">
<a href="#improving-error-messages-for-logging" class="anchor"></a>Improving error messages for logging</h2>
<p>R let’s you say what it prints when there is an error. For work on the cluster, it helps to ask R to tell you more about what went wrong. This is an example of how you would configure R to report more to the screen.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Asks R for a stack trace that shows which function had the problem.</span>
<span class="co">#'</span>
<span class="co">#' https://renkun.me/2020/03/31/a-simple-way-to-show-stack-trace-on-error-in-r/</span>
<span class="co">#' @export</span>
<span class="va">improved_errors</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/sink.html">sink</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/showConnections.html">stderr</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
        <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sink.html">sink</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>
        <span class="fu"><a href="https://rdrr.io/r/base/traceback.html">traceback</a></span><span class="op">(</span><span class="fl">3</span>, max.lines <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
            <span class="fu"><a href="https://rdrr.io/r/base/quit.html">q</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
        <span class="op">}</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">improved_errors</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The principle applies more generally, that a specific error message is more useful than a general one. In R, that means using the <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> command to insert variable values into logging messages. Watch out for these variables however, because error messages are rarely tested, so that a mis-typed variable name can make an error message, itself, become an error.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
